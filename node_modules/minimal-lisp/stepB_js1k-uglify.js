function n(t,i){for(;;){if(!(t instanceof Array))return e(t,i);if("def"==t[0])return i[t[1]]=n(t[2],i);if("`"==t[0])return t[1];if(".-"==t[0]){let n=e(t.slice(1),i),f=n[0][n[1]];return 2 in n?n[0][n[1]]=n[2]:f}if("."==t[0]){let n=e(t.slice(1),i),f=n[0][n[1]];return f.apply(n[0],n.slice(2))}if("fn"==t[0]){let f=function(...f){return n(t[2],e(t[1],i,f))};return f.ast=[t[2],i,t[1]],f}if("let"==t[0]){i=Object.create(i);for(let e in t[1])e%2&&(i[t[1][e-1]]=n(t[1][e],i));t=t[2]}else if("do"==t[0]){let n=e(t.slice(1,t.length-1),i);t=t[t.length-1]}else if("if"==t[0])t=n(t[1],i)?t[2]:t[3];else{let n=e(t,i),f=n[0];if(!f.ast)return f(...n.slice(1));t=f.ast[0],i=e(f.ast[2],f.ast[1],n.slice(1))}}}var e=function(e,t,i){return i?(t=Object.create(t),e.some((n,f)=>"&"==n?t[e[f+1]]=i.slice(f):(t[n]=i[f],0)),t):e instanceof Array?e.map((...e)=>n(e[0],t)):typeof ""==typeof e?e in t?t[e]:null[e]:e};E=Object.assign(this,{js:eval,eval:(...e)=>n(e[0],E),"=":(...n)=>n[0]===n[1],"<":(...n)=>n[0]<n[1],"+":(...n)=>n[0]+n[1],"-":(...n)=>n[0]-n[1],"*":(...n)=>n[0]*n[1],"/":(...n)=>n[0]/n[1],map:(...n)=>n[1].map(e=>n[0](e))}),b.innerHTML='<pre contenteditable>["let",["m",["`","mini"]],["+","m",["`","MAL"]]]\n["def","fac",["fn",["n"],["if","n",["*","n",["fac",["-","n",1]]],1]]]\n["map","fac",["`",[7,8,9]]]\n[".-", [".-","document",["`","body"]],["`","bgColor"],["`","cyan"]]</pre><pre></pre>',t=b.children,t[0].onkeyup=(()=>t[1].innerText=t[0].innerText.split("\n").map(e=>e?JSON.stringify(n(JSON.parse(e),E)):"").join("\n")),t[0].onkeyup()
