!function(){function n(n,e){for(;n instanceof Array&&n[0]in e&&e[n[0]].M;)n=e[n[0]](...n.slice(1));return n}function e(r,t){for(;;){if(!(r instanceof Array))return i(r,t);if(r=n(r,t),!(r instanceof Array))return i(r,t);if("def"==r[0])return t[r[1]]=e(r[2],t);if("~"==r[0]){let n=e(r[1],t);return n.M=1,n}if("`"==r[0])return r[1];if(".-"==r[0]){let n=i(r.slice(1),t),e=n[0][n[1]];return 2 in n?n[0][n[1]]=n[2]:e}if("."==r[0]){let n=i(r.slice(1),t),e=n[0][n[1]];return e.apply(n[0],n.slice(2))}if("fn"==r[0]){let n=function(...n){return e(r[2],i(r[1],t,n))};return n.A=[r[2],t,r[1]],n}if("let"==r[0]){t=Object.create(t);for(let n in r[1])n%2&&(t[r[1][n-1]]=e(r[1][n],t));r=r[2]}else if("do"==r[0]){let n=i(r.slice(1,r.length-1),t);r=r[r.length-1]}else if("if"==r[0])r=e(r[1],t)?r[2]:r[3];else{let n=i(r,t),e=n[0];if(!e.A)return e(...n.slice(1));r=e.A[0],t=i(e.A[2],e.A[1],n.slice(1))}}}let i=function(n,i,r){return r?(i=Object.create(i),n.some((e,t)=>"&"==e?i[n[t+1]]=r.slice(t):(i[e]=r[t],0)),i):n instanceof Array?n.map((...n)=>e(n[0],i)):typeof ""==typeof n?n in i?i[n]:null[n]:n},r=Object.assign(this,{js:eval,eval:(...n)=>e(n[0],r),"=":(...n)=>n[0]===n[1],"<":(...n)=>n[0]<n[1],"+":(...n)=>n[0]+n[1],"-":(...n)=>n[0]-n[1],"*":(...n)=>n[0]*n[1],"/":(...n)=>n[0]/n[1],isa:(...n)=>n[0]instanceof n[1],read:(...n)=>JSON.parse(n[0]),slurp:(...n)=>require("fs").readFileSync(n[0],"utf8"),load:(...n)=>e(JSON.parse(require("fs").readFileSync(n[0],"utf8")),r),ARGS:process.argv.slice(3)});process.argv[2]?r.load(process.argv[2]):require("repl").start({eval:(...n)=>n[3](0,e(JSON.parse(n[0]),r)),writer:JSON.stringify,terminal:0})}()
